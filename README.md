# ğŸ““ ì¼ê¸°ì¥

> í”„ë¡œì íŠ¸ ê¸°ê°„: 2022.06.13 ~ 2022.07.01 <br>
> íŒ€ì›: [Donnie](https://github.com/westeastyear), [OneTool](https://github.com/kimt4580)
> ë¦¬ë·°ì–´: [ë˜ì¹˜](https://github.com/TTOzzi)

<br>

## ğŸ” í”„ë¡œì íŠ¸ ì†Œê°œ
### "ê¸°ì–µí•˜ì§€ ë§ê³  ê¸°ë¡í•˜ì„¸ìš”! ì—¬ëŸ¬ë¶„ì˜ ê¸°ì–µì„ ì¼ê¸°ì¥ì´ ëŒ€ì‹  ì €ì¥í•´ë“œë¦½ë‹ˆë‹¤!"

<br>

## ğŸ“º í”„ë¡œì íŠ¸ ì‹¤í–‰í™”ë©´
|Viewê°€ ì‚¬ë¼ì§€ë©´ ìë™ ì €ì¥|Swipe Action|ActionSheet / Alert|
|:--:|:--:|:--:|
|<img src="https://i.imgur.com/TdhIFVr.gif" width="100%">|<img src="https://i.imgur.com/80NxVga.gif" width="100%">|<img src="https://i.imgur.com/jNcOOVG.gif" width="100%">|

|ë‚´ìš© ì—…ë°ì´íŠ¸|ë°±ê·¸ë¼ìš´ë“œ ì§„ì…ì‹œ ìë™ì €ì¥|ë‚ ì”¨ ì•„ì´ì½˜ í‘œì‹œ|
|:--:|:--:|:--:|
|<img src="https://i.imgur.com/63HulWh.gif" width="100%">|<img src="https://i.imgur.com/4MqRzE7.gif" width="100%">|<img src = "https://i.imgur.com/52PCeXX.gif" width = "100%"><br>|

<br>

## ğŸ‘€ PR

[STEP 1](https://github.com/yagom-academy/ios-diary/pull/10)
[STEP 2](https://github.com/yagom-academy/ios-diary/pull/21)
[STEP 3](https://github.com/yagom-academy/ios-diary/pull/33)

<br>

## ğŸ›  ê°œë°œí™˜ê²½ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬
- [![swift](https://img.shields.io/badge/swift-5.6-orange)]()
- [![xcode](https://img.shields.io/badge/Xcode-13.4.1-blue)]()
- [![iOS](https://img.shields.io/badge/iOS-14.0-red)]()

<br>

## ğŸ”‘ í‚¤ì›Œë“œ
`CollectionView` `MVC` `Keyboard` `ContentInset` `Padding` `ScrollView` `StackView` `Json` `NavigationBar` `TimeInterval` `DateFormatter` `CoreData` `NotificationCenter` `CoreData(CRUD)` `Cell Swipe Action` `Activity View` `Action Sheet` `Alert` `subscript` `URL` `CoreLocation` `Network` `API` `ImageView` `Migration`

<br> 

## ğŸ“‘ êµ¬í˜„ë‚´ìš©
### [STEP 1]
- ì‚¬ìš©ìì˜ ì§€ì—­ì— ë”°ë¥¸ "ë…„ì›”ì¼" í˜•ì‹ì„ `DateFormatter`ë¡œ ìœ ì—°í•˜ê²Œ êµ¬í˜„
    - `timeIntervalSince1970`ë¥¼ í™œìš©í•˜ì—¬ ë‚ ì§œê³„ì‚° ë° ì²˜ë¦¬
- `Storyboard`ì—†ì´ ì½”ë“œë¥¼ ì´ìš©í•˜ì—¬ `UI`êµ¬í˜„ 
- `Model` ìƒì„± í›„ `decode`ë¥¼ í•˜ì—¬, `data` ì‚¬ìš©
- `CollectionView`ë¥¼ í™œìš©, `ListCell` êµ¬í˜„
- `Navigation Controller`ë¥¼ í™œìš©í•˜ì—¬, `View` ë° `ViewController` ì „í™˜
- `UIResponder`, `NotificationCenter`, `keyboardWillShow`, `keyboardWillHide`ë¥¼ ì‚¬ìš©í•˜ì—¬, Keyboard êµ¬í˜„

### [STEP 2]
- `CoreData`ë¥¼ í™œìš©í•˜ì—¬ `Local`ë””ë°”ì´ìŠ¤ì— ë°ì´í„°ë¥¼ CRUD(`create`, `read`, `update`, `delete`)í•˜ëŠ” ê¸°ëŠ¥ êµ¬í˜„
- `CollectionViewListCell`ë¥¼ `Swipe`í•˜ì—¬ `Share`, `Delete`í•˜ëŠ” ê¸°ëŠ¥ ì ìš© ë° êµ¬í˜„
- `ActionSheet`ì™€ `Alert`ì˜ í™œìš©
- í•˜ë‚˜ì˜ `View`ë¥¼ ë‘ê°œì˜ `ViewController`ì—ì„œ ì‚¬ìš©í•˜ë„ë¡ ë¡œì§ êµ¬í˜„
- `Keyboard`ì˜ ë†’ì´ë§Œí¼ `ScrollView`ì— `inset`ì„ ì£¼ì–´ ë‚´ìš©ì„ ê°€ë¦¬ì§€ ì•Šë„ë¡ êµ¬í˜„
- `Array`ë¥¼ í™•ì¥í•˜ê³  `subscript`ë¥¼ í™œìš©í•˜ì—¬ `index out of range` ì˜¤ë¥˜ì²˜ë¦¬ ê¸°ëŠ¥ êµ¬í˜„

### [STEP 3]
- ì‚¬ìš©ìì—ê²Œ ìœ„ì¹˜ì •ë³´ í™œìš©ì— ëŒ€í•œ ê¶Œí•œì„ ë°›ëŠ” ê¸°ëŠ¥ êµ¬í˜„
- `URL`ì„ í™œìš©í•˜ì—¬, í†µì‹ í•˜ì—¬ ìœ„ë„, ê²½ë„ ë° í•´ë‹¹ ì§€ì—­ ë‚ ì”¨ì— í•´ë‹¹í•˜ëŠ” iconì˜ ì´ë¯¸ì§€ë¥¼ ë„£ì–´ì£¼ëŠ” ê¸°ëŠ¥ êµ¬í˜„
- CoreData Migrationì„ í™œìš©í•˜ì—¬, Model ë³€ê²½

<br>

## ğŸ“– í•™ìŠµí•œ ë‚´ìš©
### [STEP 1]
- `TimeInterval`ì„ í™œìš©í•˜ì—¬ ë‚ ì§œ ê³„ì‚°í•˜ê¸° 
> dateStyle : .full ì¸ ê²½ìš° â†’ 2022ë…„ 6ì›” 17ì¼ ê¸ˆìš”ì¼
dateStyle : .long ì¸ ê²½ìš° â†’ 2021ë…„ 6ì›” 17ì¼
dateStyle : .medium ì¸ ê²½ìš° â†’ 2022. 6. 17.
dateStyle : .short ì¸ ê²½ìš° â†’ 2022. 6. 17.

>timeStyle : .full ì¸ ê²½ìš° â†’ ì˜¤í›„ 4ì‹œ 28ë¶„ 39ì´ˆ ëŒ€í•œë¯¼êµ­ í‘œì¤€ì‹œ
timeStyle : .long ì¸ ê²½ìš° â†’ ì˜¤í›„ 4ì‹œ 29ë¶„ 39ì´ˆ GMT+9
timeStyle : .medium ì¸ ê²½ìš° â†’ ì˜¤í›„ 4:29:39
timeStyle : .short ì¸ ê²½ìš° â†’ ì˜¤í›„ 4:29

> ì¶œì²˜ : https://roniruny.tistory.com/147

- `Date Formatter`ë¡œ ì‚¬ìš©ìì˜ ì§€ì—­ì— ë”°ë¥¸ "ë…„ì›”ì¼" í˜•ì‹ì„ ë‹¤ë¥´ê²Œ êµ¬í˜„í•˜ëŠ” ë°©ë²•

### [STEP 2]
- CoreData

`CoreData`ëŠ” `Framework`ë¡œ, `permanent data`ë¥¼ ì €ì¥í•˜ì—¬ í™œìš©í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ `CoreData`ëŠ” `Database`ë¡œ ë³¼ ìˆ˜ ì—†ë‹¤. ë„“ì€ ì˜ë¯¸ë¡œ ì•±ì˜ ëª¨ë¸ ê³„ì¸µì´ê³ , ê°ì²´ ê·¸ë˜í”„ë¥¼ ê´€ë¦¬í•˜ëŠ” `Framework`ì´ë‹¤.

- Collection View Swipe Action

`Collection View`ì—ì„œ `Swipe Action`ì„ í™œìš©í•˜ê¸° ìœ„í•´ì„œëŠ”, `UICollectionLayoutListConfiguration`ì˜ `trailingSwipeActionsConfigurationProvider`ë¥¼ í™œìš©í•˜ë©´ ëœë‹¤. `trailingSwipeActionsConfigurationProvider`ì—ì„œ `UIContextualAction`ì„ í™œìš©í•˜ì—¬, `Action`ì„ ì„¤ì •í•´ì£¼ë©´ ëœë‹¤.
```swift
private var listLayout: UICollectionViewCompositionalLayout {
        var configure = UICollectionLayoutListConfiguration(appearance: .plain)
        configure.showsSeparators = true
        configure.backgroundColor = .clear
        configure.trailingSwipeActionsConfigurationProvider = { [weak self] indexPath in
            let share = UIContextualAction(style: .normal, title: nil) { [weak self] _, _, completion in
                guard let diaryTitle = self?.diaryData[indexPath.row].title else {
                    return
                }
                let activityViewController = UIActivityViewController(
                    activityItems: [diaryTitle],
                    applicationActivities: nil
                )
                self?.present(activityViewController, animated: true)
                completion(true)
            }
            share.image = UIImage(systemName: DiaryConstants.cellSwipeShareButton)
            share.backgroundColor = .systemBlue
            
            let delete = UIContextualAction(style: .destructive, title: nil) { [weak self] _, _, completion in
                guard let diaryData = self?.diaryData[indexPath.row] else {
                    return
                }
                self?.persistenceManager.delete(diary: diaryData)
                self?.diaryData.remove(at: indexPath.row)
                self?.collectionView.deleteItems(at: [indexPath])
                completion(true)
            }
            delete.image = UIImage(systemName: DiaryConstants.cellSwipeDeleteButton)
            return UISwipeActionsConfiguration(actions: [delete, share])
        }
        return UICollectionViewCompositionalLayout.list(using: configure)
    }
```
- NotificationCenterë¥¼ í™œìš©í•œ background Task

`background` ìƒíƒœì— ì§„ì…í•˜ê³  ë‚˜ì„œ, `Task`ë¥¼ ì›í•œë‹¤ë©´ `didEnterBackgroundNotification`ì— ëŒ€í•œ `Observer`ë¥¼ ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤.
```swift
  NotificationCenter.default.addObserver(
            self,
            selector: #selector(/*@objc method*/),
            name: UIApplication.didEnterBackgroundNotification,
            object: nil
        )
```
<br>

### [STEP 3]
- ViewModelê³¼ Controllerì˜ ê´€ê³„
ì²˜ë¦¬ê°€ í•„ìš”í•œ ë¡œì§ë“¤ì€ ëŒ€ë¶€ë¶„ ViewModelì—ì„œ ì²˜ë¦¬í•´ì£¼ê³ , ControllerëŠ” ì‚¬ìš©ìì—ê²Œ ì…ë ¥ ë°›ì€ ê°’ë§Œ ë„˜ê²¨ì£¼ëŠ” ì—­í•  ì´ë¼ëŠ” ê²ƒì„ ì•Œì•˜ë‹¤. MVVM íŒ¨í„´ì— ëŒ€í•´ì„œ ì¡°ê¸ˆì´ë‚˜ë§ˆ í•™ìŠµí•˜ê²Œ ë˜ì—ˆë‹¤.

- MVVM êµ¬ì¡°

<img src="https://i.imgur.com/za6oQgQ.png" width="60%">
<br>
>Model: ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë°ì´í„°ì™€ ê·¸ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¶€ë¶„
View : ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” UI
View Model : Viewë¥¼ ë‚˜íƒ€ë‚´ì£¼ê¸° ìœ„í•œ Modelì´ë©°, Viewë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•œ ë°ì´í„° ì²˜ë¦¬ë¥¼ í•˜ëŠ” ë¶€ë¶„

- MVVM ë™ì‘ ìˆœì„œ
> Userì˜ Action -> View -> View Model -> Model -> View Model -> Data Binding -> UI

- MVVM íŠ¹ì§•
> Command íŒ¨í„´ + Data Binding íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„, Viewì™€ View Model ì‚¬ì´ì˜ ì˜ì¡´ì„±ì„ ì—†ì• ê³ , View Modelê³¼ Viewì˜ ê´€ê³„ë¥¼ 1:n ê´€ê³„ë¡œ ë§Œë“¤ì—ˆë‹¤. Viewì™€ View Modelì´ ë…ë¦½ì ì´ê¸° ë•Œë¬¸ì—, ëª¨ë“ˆí™”ê°€ ê°€ëŠ¥í•˜ë‹¤. í•˜ì§€ë§Œ, View Modelì˜ ì„¤ê³„ ë‚œì´ë„ê°€ ìƒë‹¹íˆ ë†’ë‹¤.
>> [Design Pattern ì»¤ë§¨ë“œ íŒ¨í„´ì´ë€](https://gmlwjd9405.github.io/2018/07/07/command-pattern.html)
>> [Data Binding in MVVM on iOS](https://beenii.tistory.com/124)

## ğŸš€ trouble shooting

### [STEP 1]
### 1. JSONê²¬ë³¸ íŒŒì¼ì— ìˆëŠ” created_At ìˆ«ìì˜ ì˜ë¯¸ë¥¼ ì•Œì•„ë‚´ê³ , ì‚¬ìš©ìì˜ ì§€ì—­ì— ë”°ë¼ ë‚ ì§œ í¬ë§·ì„ ë‹¤ë¥´ê²Œ í•˜ê¸° ìœ„í•´ ê³ ë¯¼í•˜ì˜€ìŠµë‹ˆë‹¤. 

- JSONê²¬ë³¸ íŒŒì¼ì— ìˆëŠ” createdAtì˜ ìˆ«ìì˜ ì˜ë¯¸ë¥¼ ì•Œì•„ë‚´ê¸° ìœ„í•´ ë‹¤ë¥¸ ìº í¼ë“¤ê³¼ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ì—ˆê³ , ì–´ë–»ê²Œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ”ê°€ì— ê³ ë¯¼ì„ í•˜ì˜€ìŠµë‹ˆë‹¤.
- ê·¸ëŸ¬ë©´ì„œ ì‚¬ìš©ìê°€ ì„¤ì •í•˜ëŠ” ì§€ì—­ì— ë”°ë¼ ë‹¤ë¥´ê²Œ í¬ë§·ì„ ì£¼ì–´ì•¼ í–ˆì–´ì„œ TimeIntervalì„ í™•ì¥í•˜ì˜€ê³ , ì•„ë˜ì™€ ê°™ì€ formattedDateë¼ëŠ” ì—°ì‚° í”„ë¡œí¼í‹°ë¥¼ ë§Œë“¤ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

```swift
extension TimeInterval {
    var formattedDate: String {
        let dateFormatter = DateFormatter()
        let localID = Locale.preferredLanguages.first
        let deviceLocale = Locale(identifier: localID ?? "ko-kr").languageCode
        dateFormatter.dateStyle = .long
        dateFormatter.locale = Locale(identifier: deviceLocale ?? "ko-kr")
        dateFormatter.timeZone = TimeZone.current
        return dateFormatter.string(from: Date(timeIntervalSince1970: self))
    }
}
```

<br>

### 2. ìº¡ìŠí™”ë¥¼ ì¤€ìˆ˜í•˜ê¸° ìœ„í•´ ê³ ë¯¼í•˜ì˜€ìŠµë‹ˆë‹¤.

![](https://i.imgur.com/FpnakIj.png)

![](https://i.imgur.com/qSHhmED.png)

![](https://i.imgur.com/T5HPVXU.png)

- ìº¡ìŠí™”ë¥¼ í•˜ê¸° ìœ„í•´ì„œ, `private`ì„ ëª¨ë‘ ì‚¬ìš©í•´ì£¼ë ¤ê³  í•˜ì˜€ìœ¼ë‚˜, ViewControllerì—ì„œ Keyboardì˜ ë†’ì´ë¥¼ ì¡°ì •í•  ë•Œ `mainScrollView`ì™€ `descriptionView`ë¥¼ ì‚¬ìš©í•´ì•¼í–ˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê²½ìš°ì—ëŠ” ìº¡ìŠí™”ë¥¼ ì–´ë–»ê²Œ í•´ì£¼ëŠ” ê²Œ ì¢‹ì„ê¹Œìš”? 
>`KeyboardLayoutGuide`ë¥¼ ì‚¬ìš©í•´ë©´ í•´ê²°ë˜ê² ì§€ë§Œ, iOS 15ì´ìƒì´ë¼ì„œ ì§€ì–‘í–ˆìŠµë‹ˆë‹¤!

---

### [STEP 2]
### 1. CoreData Attribute, Propertiesì™€ Model Type
- ë°©ë²•ì´ ë‘ê°€ì§€ê°€ ìˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤. 
>1. Entityë¥¼ ê° ViewControllerê°€ ê°€ì§€ê³  ìˆê²Œ ë§Œë“¤ê³ , ì§ì ‘ì ìœ¼ë¡œ CoreDataì— ì ‘ê·¼í•˜ëŠ” ë°©ì‹
>2. Entityë¥¼ ìƒì„±í•´ë‘ì—ˆë˜ Modelì´ë‘ Typeì„ ë§ì¶°ì£¼ì–´ì„œ ì§ì ‘ Entityë¡œ ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ Modelì„ í†µí•˜ì—¬ ì ‘ê·¼í•˜ëŠ” ë°©ì‹

ì§ì ‘ì ì¸ ì ‘ê·¼ì€ ì•ˆì „í•˜ì§€ ì•Šì„ ê²ƒ ê°™ì•„ì„œ, 2ë²ˆì„ ì„ íƒí•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.
```swift
//
//  DiaryEntity+CoreDataProperties.swift
    @NSManaged public var body: String?
    @NSManaged public var createdAt: Date
    @NSManaged public var title: String?
    @NSManaged public var id: String
```
```swift
//
//  DiaryModel.swift
struct DiaryModel: Decodable {
    let title: String?
    let body: String?
    let createdAt: Date
    let id: String
    
    private enum CodingKeys: String, CodingKey {
        case createdAt = "created_at"
        case title, body, id
    }
}
```
![](https://i.imgur.com/aiC97M9.png)

---
### [STEP 3]

### 1. í”„ë¡œí¼í‹°ë¡œ icon ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë°©ì‹ì— ëŒ€í•´ì„œ
- í˜„ì¬ `RegisterViewController`ì—ì„œ diaryModelì— ë°ì´í„°ê°€ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ì— ëŒ€í•´ì„œ, ë¶„ê¸°ì²˜ë¦¬ë¥¼ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. 
- ê·¸ë¡œ ì¸í•´ì„œ iconì˜ ë°ì´í„°ë¥¼ CoreDataì— ì €ì¥ì„ í•´ì¤€ í›„, ì‹¤í–‰í•˜ê²Œë˜ë©´ ë°ì´í„° ìœ ë¬´ë¥¼ ì²´í¬í•´ì£¼ëŠ” ë¡œì§ì—ì„œ CoreDataì— createë§Œ ì§„í–‰í•˜ê²Œ ë©ë‹ˆë‹¤. 
- ê³„ì†í•´ì„œ CoreData ìì›ì„ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤. ê·¸ë˜ì„œ ì§ì ‘ì ìœ¼ë¡œ CoreDataì˜ DiaryDataì— iconì— ëŒ€í•œ ì •ë³´ë¥¼ ì €ì¥í•´ì£¼ì—ˆê³ , `RegisterViewController`ì—ì„œ ì‚¬ìš©ë˜ëŠ” diaryModelì—ëŠ” ë°ì´í„°ì˜ ìœ ë¬´ë¥¼ íŒë‹¨í•  ìˆ˜ ìˆëŠ” ë¶„ê¸°ì²˜ë¦¬ìš© ë¡œì§ì„ ìœ ì§€ë˜ê²Œ í•˜ì˜€ìŠµë‹ˆë‹¤.

```swift
private var icon: String?

private func sendDiaryViewModel() {
        do {
            try diaryViewModel.checkDiaryData(
                title: detailView.titleField.text,
                body: detailView.descriptionView.text,
                icon: icon
            )
        } catch {
            showAlert(alertMessage: error.localizedDescription)
        }
    }
}
```
